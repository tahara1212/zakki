---
title: "テスト手法とテスト戦略"
category: "読書記録"
---

# フロントエンド開発テスト入門

## テスト手法とテスト戦略

### ●テストの範囲

Webアプリケーションコードは、様々なモジュールを組み合わせて実装する。

仮に1つの機能を提供する場合、以下のような一連のモジュール（システム）が必要になる。

1. ライブラリが提供する関数 
2. ロジックを担う関数 
3. UIを表現する関数 
4. Web APIクライアント 
5. APIサーバー 
6. DBサーバ

フロントエンドのテストを書くとき、これらのどこからどこまでの範囲をカバーしたテストであるか、を意識する必要がある。

### ●テストレベルの分類

- 静的解析
    
    TypeScriptやESLintによる静的解析。「隣接するモジュール間連携の不整合」に対して検証を行う。主に②と③の間、③と④の間。
    
- 単体テスト
    
    「モジュール単体が提供する機能」に着目したテスト。独立した検証を行えるため、コーナーケース（めったに発生しないケース）に向いている。主に②のみ、③のみ
    
- 結合テスト
    
    ①〜④まで、②〜③までというように「モジュールをつなげることで提供できる機能」に着目したテスト。範囲が広いほどテスト対象を効率よくカバーすることができる一方で、相対的にざっくりとした検証になる傾向がある。
    
- E2Eテスト（End to Endテスト）
    
    ①〜⑥を通し、[ヘッドレスブラウザ](https://www.notion.so/673b88780c5f4258814d9b4eb053d8f9?pvs=21)＋[UIオートメーション](https://www.notion.so/673b88780c5f4258814d9b4eb053d8f9?pvs=21)で実施するテスト。最も広範囲な結合テストで、アプリケーション稼働状況に忠実である。
    

### ●テストの目的（テストタイプ）

テストタイプは検証目的に応じて設定され、テストタイプごとに適したテストツールが存在する。Webフロントエンドテストにおいて代表的なテストタイプは以下。

- 機能テスト（インタラクションテスト）
    
    開発した機能に不具合がないかを検証する。Webフロントエンドにおける開発対象の大部分はUIコンポーネントの操作（インタラクション）を起点とするため、インタラクションテストが機能テストそのものになるケースが多い。本物のブラウザAPIを使用することが重要な場合、[ヘッドレスブラウザ](https://www.notion.so/673b88780c5f4258814d9b4eb053d8f9?pvs=21)＋[UIオートメーション](https://www.notion.so/673b88780c5f4258814d9b4eb053d8f9?pvs=21)を使用して自動テストを書く。
    
- 非機能テスト（アクセシビリティテスト）
    
    心身特性に隔てのない製品を提供できているかという検証が「アクセシビリティテスト」。Webアクセシビリティに関するAPIが様々なプラットフォームで展開されており、自動テストでも客観的に判定できる環境が整っている。
    
- リグレッションテスト
    
    特定時点から、前後の差分を検出して想定外の不具合が発生していないかを検証するテスト。Webフロントエンドにおける開発対象の大部分が見た目（ビジュアル）を持つUIコンポーネントであるため、「ビジュアルリグレッションテスト」が重要視されている。
    

### ●テスト戦略モデル

上層のテストほど忠実性が高い（本物の環境に近い）一方で、実行時間が長くコストもかかる。

上層のテストは、実行するにあたり本物に近いテスト環境を揃える必要があり、テスト用に用意したDBサーバーを起動してセットアップするといった工程を行う。ほかにも、テストを実行する度に、連携する外部システムのレスポンスを全て待つ必要がある。

コスト配分をどのように設計して最適化を行うかが、テスト戦略最大の検討事項になる。

![スクリーンショット 2024-10-05 14.01.37.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4fc61ac9-b4cf-4a6f-b4b2-c624a50e6c56/61ed69ae-61c9-4416-b075-8f6eac0fd401/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-10-05_14.01.37.png)

### アイスクリームコーン型、テストピラミッド型

以下の図の左側、アイスクリームコーン型は、上層のテストを多く実行するモデルである。上層のテストは運用のコストが高いだけでなく、稀に失敗するリスクもあり、実行時間も長い。全てのテストをパスするのに何十分もかかる場合、日常の開発フローに影響が出るため、戦略モデルのアンチパターンとして参照される事が多い。

右側の図はテストピラミッド型で、下層のテストを多く書くことによってアイスクリームコーン型よりも費用対効果の高い戦略モデルになる。実行時間も高速であり、単体テストなどの細かい機能レベルでテストを行うため失敗のリスクも低い。手動テストなどの「時間がかかり、かつ失敗の可能性がある」ような上層のテストの比重を軽くする戦略である。

![スクリーンショット 2024-10-05 14.06.15.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4fc61ac9-b4cf-4a6f-b4b2-c624a50e6c56/b1f33a00-05e8-46eb-983e-bc03fecb87f1/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-10-05_14.06.15.png)

### テスティングトロフィー型

テスティングトロフィー型は、結合テストに最も比重を置いた戦略モデルである。Webフロントエンドは単体のUIコンポーネントだけで成立する機能は少なく、UIの操作によって外部 Web API へのリクエストが発生することが多い。このような機能は一般的に複数のモジュールを組み合わせて実現されるため、これらの操作を起点とする結合テストをより重点的に行うべきという考え方になる。

![スクリーンショット 2024-10-05 14.16.33.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4fc61ac9-b4cf-4a6f-b4b2-c624a50e6c56/9935a88f-14ac-4b96-9ac3-8ac7cb78069b/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-10-05_14.16.33.png)

Testing LibraryとJestを使用したテストは、ヘッドレスブラウザを用意しなくともユーザー操作が行えるという特徴がある。実行速度が速く、忠実性の高いテストが叶う可能性が高い。